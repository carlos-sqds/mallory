# Helper Flow: Complete Login
# This sub-flow handles the full login process including OAuth and Grid OTP
# Can be imported by other tests using: runFlow: helpers/login.yaml

appId: ${APP_ID}

---

# Step 1: Tap Google Sign-In button
- tapOn: "Continue with Google"
- waitForAnimationToEnd

# Step 2: OAuth happens externally (Google redirects back)
# We wait for either the OTP modal or direct entry to chat
- waitForAnimationToEnd:
    timeout: ${TIMEOUT_LONG}

# Step 3: Check if we need to complete Grid OTP
- runFlow:
    when:
      visible: "Enter verification code"
    commands:
      - inputText: "${TEST_GRID_OTP}"
      - tapOn: "Verify"
      - waitForAnimationToEnd:
          timeout: ${TIMEOUT_MEDIUM}

# Step 4: Verify we're logged in
- assertVisible: 
    text: ".*"  # Chat interface or any authenticated screen
    timeout: ${TIMEOUT_MEDIUM}

